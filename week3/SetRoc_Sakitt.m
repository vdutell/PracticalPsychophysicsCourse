function [dif, dprime,expect,sigma,z_score]= SetRoc_Sakitt(params, data,info);%Used by lsqnonlin to get the difference between expected and observed%The first nresp-1 parameters are the criteria values (or difference in values). %the next two are d' for weak & strong. The last param is for Gaussian SD.z2p= @(z)(1+erf(z/sqrt(2)))/2;[nresp nstim] = size(data) ;nparams=length(params);dprime=[0 params(nresp:nresp+nstim-2)]; %indep d' sigma=1+params(nparams)*dprime;%float ROC slope paramif info==1,crit1= params(1:nresp-1)';  %The first params are the criteriaelse crit1=cumsum(params(1:nresp-1)'); %params are the diferences in criteriaendcrit2=crit1*ones(1,nstim); %needed to make criteria a two-dimensional matrixdprime2=ones(nresp-1,1)*dprime; sigma2 =ones(nresp-1,1)*sigma;z_score= (dprime2 - crit2)./sigma2;%hit rateprob=[ones(1,nstim);z2p(z_score);zeros(1,nstim)];%erf to cumnormexpect_prob=-diff(prob);%responses in each categoryN_data=ones(nresp,1)*sum(data);      %number of trials per stimulusexpect=expect_prob.*N_data;			         %expected number of eventsdif= (expect- data)./sqrt(expect+eps);%the deviation (SE) units for leastsq